function Sm = calcSm_compPulse(sf,g,pw)

% Set constants
gamma = 42.58*2*pi;         % rad/s/uT
% Set flip angles, multilpy by B1, and convert to rad and rad/s
theta = [13.402 11.5127 10.9016 10.2936 10.6975 12.2491 14.3559 16.2912
    18.1403 19.1458 19.5985 19.6136 19.3275 18.8735 18.4199 18.3555
    18.3904 0.0438277 0.0410242 19.7832 20.6567 21.6633 22.6939 23.5855
    24.2485 24.5967 24.4735 23.9955 23.2564 22.6117 22.0894 21.6416
    21.4135 21.6053 22.0667 22.9694 23.8643 24.6755 25.6727 26.0248
    25.9332 25.2734 24.2958 22.7786 21.546 20.3494 19.3594 19.0169
    0.0439204 18.9474 19.3957 20.0943 20.9302 21.7482 22.2219 22.0159
    20.9151 19.0366 16.6266 13.7381 11.8496 11.6415 12.7614 14.8433];
theta = theta'*sf;
theta = theta(:)*pi/180;
tp = pw./length(theta);
B1 = theta./gamma/tp;
w1 = theta./tp;

% Set phases and convert to rad
phi = [-164.4 -174.654 158.519 135.825 112.792 91.8596 73.0292 54.6285
    38.6675 24.6251 12.2792 1.73148 -7.5045 -16.0175 -24.2155 -32.1668
    -39.4829 143.545 137.607 -50.0594 -56.8837 -63.2923 -69.261 -74.757
    -79.739 -84.1907 -88.1259 -91.6031 -94.32 -96.5891 -98.4867 -99.7875
    -100.65 -101.081 -100.68 -99.8525 -98.6924 -97.2153 -95.245 -92.9061
    -90.005 -86.5152 -82.3649 -77.5482 -72.0741 -65.9375 -59.0529 -52.0762
    124.347 -42.601 -35.5392 -28.3555 -20.711 -12.201 -1.99576 10.7172
    26.3764 45.2246 67.3821 91.0792 116.404 143.011 164.707 175.883];
phi = phi';
phi = phi(:)*pi/180;

% Get solid pool saturation rate
R_RFB = pi*w1.^2*g;

% Estimate saturation (neglect exchange and relaxation)
Sm = cumprod(exp(-R_RFB*tp));
Sm = Sm(end);

